---
typora-root-url: ./..\..\public\
---

# 文件系统性能

衡量和分析文件系统性能是编写文件系统的一个重要组成部分。如果没有一些衡量文件系统实现的指标，就没有办法评估其质量。我们可以通过其他一些指标来判断文件系统——例如，可靠性——但我们假设，在考虑性能之前，可靠性必须是前提。衡量性能对于理解应用程序的表现以及文件系统能够处理的工作负载类型很有用。

## 9.1 什么是性能？

文件系统的性能有许多不同的方面。衡量文件系统的性能有许多不同的方法，这是一个活跃的研究领域。事实上，甚至没有一个与 CPU 的 SPEC 基准测试相对应的常用磁盘基准测试。不幸的是，似乎每当一个新的文件系统被编写出来，新的基准测试也会随之被编写出来。这使得比较文件系统变得非常困难。

有三个主要的文件系统衡量类别是值得关注的：

- 吞吐量基准测试（每秒兆字节的数据传输量）
- 元数据密集型基准测试（每秒操作数）
- 真实世界工作负载（吞吐量或每秒事务数）

吞吐量基准测试衡量文件系统在各种条件下每秒可以提供多少兆字节的数据传输量。最简单的情况是文件的顺序读写。使用多线程、不同文件大小和文件数量也可以进行更复杂的吞吐量测量。吞吐量测量非常依赖于所使用的磁盘，因此，绝对测量虽然有用，但在不同系统之间进行比较很困难，除非使用相同的硬盘。一个更有用的衡量标准是文件系统达到的原始磁盘带宽的百分比。也就是说，直接对磁盘设备执行大的顺序 I/O 会产生一定的数据传输速率。将文件系统顺序 I/O 的吞吐量作为原始磁盘带宽的百分比来衡量，可以得到一个更容易比较的数字，因为这个百分比实际上是一个归一化数字。传输速率非常接近原始驱动器传输速率的文件系统是理想的。

元数据密集型基准测试衡量文件系统每秒可以执行的操作数量。文件系统执行的主要元数据密集型操作是打开、创建、删除和重命名。在这些操作中，重命名通常不被视为性能瓶颈，因此很少被关注。其他操作会显著影响使用文件系统的应用程序的性能。每秒的操作数越高，文件系统的性能越好。

真实世界基准测试利用文件系统来执行一些任务，例如处理电子邮件或互联网新闻、从存档中提取文件、编译大型软件系统或复制文件。除了文件系统本身之外，许多不同的因素会影响真实世界基准测试的结果。例如，如果虚拟内存系统和磁盘缓冲区缓存集成在一起，系统可以更有效地利用内存作为磁盘缓存，从而提高性能。尽管统一的 VM 和缓冲区缓存可以提高大多数与磁盘相关的测试的性能，但这与文件系统的质量（或不足）无关。尽管如此，真实世界基准测试很好地表明了一个系统执行特定任务的能力。关注真实世界任务的性能很重要，这样系统才不会被优化成只运行特定的合成基准测试。
